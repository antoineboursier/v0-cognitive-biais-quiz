{"version":3,"sources":["../../../../app/test-supabase/page.tsx","../../../../lib/supabase/test-connection.ts"],"sourcesContent":["\"use client\"\n\nimport { useState } from 'react';\nimport { testSupabaseConnection } from '@/lib/supabase/test-connection';\nimport { Button } from '@/components/ui/button';\nimport { Card } from '@/components/ui/card';\n\nexport default function TestSupabasePage() {\n    const [result, setResult] = useState<string>('');\n    const [isLoading, setIsLoading] = useState(false);\n\n    const runTest = async () => {\n        setIsLoading(true);\n        setResult('Test en cours...\\n');\n\n        // Rediriger console.log vers notre interface\n        const originalLog = console.log;\n        const originalError = console.error;\n        const logs: string[] = [];\n\n        console.log = (...args) => {\n            logs.push(args.join(' '));\n            originalLog(...args);\n        };\n\n        console.error = (...args) => {\n            logs.push('‚ùå ' + args.join(' '));\n            originalError(...args);\n        };\n\n        try {\n            await testSupabaseConnection();\n        } catch (error) {\n            logs.push(`\\n‚ùå Erreur fatale: ${error}`);\n        }\n\n        // Restaurer console\n        console.log = originalLog;\n        console.error = originalError;\n\n        setResult(logs.join('\\n'));\n        setIsLoading(false);\n    };\n\n    return (\n        <div className=\"min-h-screen bg-gray-950 text-white p-8\">\n            <div className=\"max-w-4xl mx-auto\">\n                <h1 className=\"text-3xl font-bold mb-4 text-cyan-400\">\n                    üîß Test de connexion Supabase\n                </h1>\n\n                <Card className=\"p-6 bg-gray-900/50 border-gray-800 mb-6\">\n                    <p className=\"text-gray-400 mb-4\">\n                        Cette page vous permet de tester la connexion √† Supabase et de v√©rifier que tout est correctement configur√©.\n                    </p>\n\n                    <Button\n                        onClick={runTest}\n                        disabled={isLoading}\n                        className=\"bg-cyan-500 hover:bg-cyan-600 text-black font-semibold\"\n                    >\n                        {isLoading ? 'Test en cours...' : 'Lancer le test'}\n                    </Button>\n                </Card>\n\n                {result && (\n                    <Card className=\"p-6 bg-gray-900/50 border-gray-800\">\n                        <h2 className=\"text-xl font-bold mb-4 text-white\">R√©sultats :</h2>\n                        <pre className=\"bg-black/50 p-4 rounded overflow-auto text-sm text-gray-300 whitespace-pre-wrap\">\n                            {result}\n                        </pre>\n                    </Card>\n                )}\n\n                <Card className=\"p-6 bg-gray-900/50 border-gray-800 mt-6\">\n                    <h2 className=\"text-xl font-bold mb-4 text-yellow-400\">\n                        üìù Comment cr√©er la table user_scores\n                    </h2>\n\n                    <div className=\"bg-red-500/10 border border-red-500/50 rounded-lg p-4 mb-4\">\n                        <p className=\"text-red-400 font-bold\">\n                            ‚ö†Ô∏è LA TABLE \"user_scores\" N'EXISTE PAS DANS VOTRE BASE DE DONN√âES !\n                        </p>\n                        <p className=\"text-gray-300 mt-2\">\n                            Suivez les √©tapes ci-dessous pour la cr√©er.\n                        </p>\n                    </div>\n\n                    <ol className=\"list-decimal list-inside space-y-3 text-gray-300\">\n                        <li>\n                            <strong className=\"text-white\">Ouvrez le SQL Editor de Supabase</strong>\n                            <br />\n                            <a\n                                href=\"https://supabase.com/dashboard/project/xrlvfnqnbuwckddrspav/sql/new\"\n                                target=\"_blank\"\n                                rel=\"noopener noreferrer\"\n                                className=\"text-cyan-400 underline hover:text-cyan-300 ml-6\"\n                            >\n                                ‚Üí Cliquez ici pour ouvrir directement le SQL Editor\n                            </a>\n                        </li>\n\n                        <li>\n                            <strong className=\"text-white\">Copiez le script SQL</strong>\n                            <br />\n                            <span className=\"ml-6 text-sm\">\n                                Ouvrez le fichier <code className=\"bg-black/50 px-2 py-1 rounded\">supabase_migration.sql</code> dans votre projet\n                            </span>\n                        </li>\n\n                        <li>\n                            <strong className=\"text-white\">Collez et ex√©cutez</strong>\n                            <br />\n                            <span className=\"ml-6 text-sm\">\n                                Collez le script dans l'√©diteur SQL et cliquez sur <strong>\"Run\"</strong> (ou Cmd+Enter)\n                            </span>\n                        </li>\n\n                        <li>\n                            <strong className=\"text-white\">V√©rifiez</strong>\n                            <br />\n                            <span className=\"ml-6 text-sm\">\n                                Vous devriez voir : <span className=\"text-green-400\">‚úÖ Success. No rows returned</span>\n                            </span>\n                        </li>\n\n                        <li>\n                            <strong className=\"text-white\">Retestez</strong>\n                            <br />\n                            <span className=\"ml-6 text-sm\">\n                                Revenez ici et cliquez √† nouveau sur \"Lancer le test\"\n                            </span>\n                        </li>\n                    </ol>\n\n                    <div className=\"mt-4 p-3 bg-blue-500/10 border border-blue-500/50 rounded\">\n                        <p className=\"text-blue-300 text-sm\">\n                            üí° <strong>Astuce</strong> : Le guide complet est disponible dans le fichier <code className=\"bg-black/50 px-2 py-1 rounded\">GUIDE_SUPABASE.md</code>\n                        </p>\n                    </div>\n                </Card>\n\n                <div className=\"mt-6 text-center\">\n                    <a\n                        href=\"/\"\n                        className=\"text-cyan-400 hover:text-cyan-300 underline\"\n                    >\n                        ‚Üê Retour √† l'application\n                    </a>\n                </div>\n            </div>\n        </div>\n    );\n}\n","/**\n * Script de test de la connexion Supabase\n * Ex√©cutez ce fichier dans la console du navigateur pour v√©rifier :\n * 1. La connexion √† Supabase\n * 2. L'existence de la table user_scores\n * 3. Les permissions\n */\n\nimport { createClient } from '@/lib/supabase/client';\n\nexport async function testSupabaseConnection() {\n    console.log('üîç Test de connexion Supabase...');\n\n    const supabase = createClient();\n\n    // Test 1: V√©rifier que le client existe\n    console.log('‚úÖ Client Supabase cr√©√©');\n\n    // Test 2: V√©rifier la table user_scores existe\n    console.log('\\nüìä Test de la table user_scores...');\n\n    const { data, error } = await supabase\n        .from('user_scores')\n        .select('*')\n        .limit(1);\n\n    if (error) {\n        console.error('‚ùå Erreur lors de l\\'acc√®s √† la table:', error);\n\n        if (error.code === '42P01') {\n            console.error('\\n‚ö†Ô∏è LA TABLE \"user_scores\" N\\'EXISTE PAS !');\n            console.log('\\nüìù SOLUTION :');\n            console.log('1. Allez sur https://supabase.com/dashboard');\n            console.log('2. S√©lectionnez votre projet');\n            console.log('3. Allez dans \"SQL Editor\"');\n            console.log('4. Copiez le contenu de \"supabase_migration.sql\"');\n            console.log('5. Collez et ex√©cutez le script');\n        } else if (error.code === 'PGRST301') {\n            console.error('\\n‚ö†Ô∏è PROBL√àME DE PERMISSIONS (RLS) !');\n            console.log('\\nüìù SOLUTION :');\n            console.log('1. V√©rifiez que les policies RLS sont bien configur√©es');\n            console.log('2. Ex√©cutez le script supabase_migration.sql qui configure les permissions');\n        } else {\n            console.error('\\n‚ö†Ô∏è ERREUR INCONNUE:', error.message);\n        }\n\n        return { success: false, error };\n    }\n\n    console.log('‚úÖ Table user_scores accessible !');\n    console.log('üìä Donn√©es de test:', data);\n\n    // Test 3: Test d'insertion\n    console.log('\\nüìù Test d\\'insertion...');\n\n    const testData = {\n        email: 'test@example.com',\n        first_name: 'Test',\n        last_name: 'User',\n        job: 'Tester',\n        total_score: 0,\n        total_questions: 60,\n        level_1_score: 0,\n        level_2_score: 0,\n        level_3_score: 0,\n        answered_questions: [],\n        unlocked_biases: [],\n        all_levels_completed: false,\n    };\n\n    const { data: insertData, error: insertError } = await supabase\n        .from('user_scores')\n        .upsert(testData, { onConflict: 'email' })\n        .select();\n\n    if (insertError) {\n        console.error('‚ùå Erreur lors de l\\'insertion:', insertError);\n        return { success: false, error: insertError };\n    }\n\n    console.log('‚úÖ Test d\\'insertion r√©ussi !');\n    console.log('üìä Donn√©es ins√©r√©es:', insertData);\n\n    console.log('\\n‚úÖ TOUS LES TESTS SONT PASS√âS !');\n    console.log('üéâ Supabase est correctement configur√© !');\n\n    return { success: true };\n}\n\n// Pour l'ex√©cuter, importez et appelez cette fonction dans votre composant\n// ou ex√©cutez-la dans la console du navigateur\n"],"names":[],"mappings":"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"}